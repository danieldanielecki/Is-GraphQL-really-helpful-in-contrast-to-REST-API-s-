<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/black.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>Is GraphQL really helpful in contrast to REST API's?</section>
			<section>What is GraphQL?</section>
			<section>
				<h1>What is a GraphQL?</h1>
				<p>Query language for API's, <strong>alternative</strong> (not replacement) for REST.</p>
			</section>
			<section>GraphQL vs REST</section>
			<section>
				<h1>GraphQL vs REST</h1>
				<table>
					<tr>
						<th>Feature</th>
						<th>REST</th>
						<th>GraphQL</th>
						<th>Similar/Different</th>
					</tr>
					<tr>
						<td>HTTP</td>
						<td>Yes</td>
						<td>Yes</td>
						<td>Similar</td>
					</tr>
					<tr>
						<td>API endp.</td>
						<td>Yes</td>
						<td>Yes</td>
						<td>Similar</td>
					</tr>
					<tr>
						<td>JSON</td>
						<td>Yes</td>
						<td>Yes</td>
						<td>Similar</td>
					</tr>
					<tr>
						<td>Request</td>
						<td>Rigid</td>
						<td>Flexible</td>
						<td>Different</td>
					</tr>
					<tr>
						<td>Call API</td>
						<td>Endpoint</td>
						<td>Query</td>
						<td>Different</td>
					</tr>
					<tr>
						<td>Response</td>
						<td>Server</td>
						<td>Client</td>
						<td>Different</td>
					</tr>
					<tr>
						<td>Size resp.</td>
						<td>Server</td>
						<td>Client</td>
						<td>Different</td>
					</tr>
				</table>
			</section>
			<section>Why GraphQL?</section>
			<section>
				<h1>Why GraphQL?</h1>
				<p>Query only what you need.</p>
			</section>
			<section>
				<h1>Why GraphQL?</h1>
				<ul>
					<li>Performance*</li>
					<li>Single Endpoint</li>
					<li>Subscriptions</li>
					<li>Strong Typing</li>
				</ul>
			</section>
			<section>GraphQL Basics</section>
			<section>GraphQL Basics: Schema</section>
			<section>
				<pre><code>
type Query { ... }
type Mutation {	... }
type Subscription { ... }
input CreateUserInput { ... }
				</code></pre>
			</section>
			<section>GraphQL Basics: Object Types</section>
			<section>
				<h2>GraphQL Basics: Object Types</h2>
				<pre><code>
type User {
	id: ID!
	name: String!
	email: String!
	age: Int
	posts: [Post!]!
}
type Post {
	id: ID!
	title: String!
	body: String!
	author: User!
}
				</code></pre>
			</section>
			<section>GraphQL Basics: Query</section>
			<section>
				<h2>GraphQL Basics: Query</h2>
				<pre><code>
type Query {
	users(query: String): [User!]!
	posts(query: String): [Post!]!
	dummy: User!
	post: Post!
}
				</code></pre>
			</section>
			<section>
				<h2>GraphQL Basics: Query</h2>
				<pre><code>
query {
	dummy {
		id
	}
}
				</code></pre>
			</section>
			<section>GraphQL Mutations and Subscriptions</section>
			<section>
				<h2>GraphQL Mutations</h2>
				<pre><code>
type Mutation {
	createUser(data: CreateUserInput!): User!
	deleteUser(id: ID!): User!
	updateUser(id: ID!, data: UpdateUserInput!): User!
}

input CreateUserInput {
  name: String!
  email: String!
  age: Int
}
				</code></pre>
			</section>
			<section>
				<h2>GraphQL Mutations</h2>
				<pre><code>
mutation {
	createUser(data: { name: "Daniel", email: "foo@example.com", age: 25 }) {
		id
		email
		age
	}
}
				</code></pre>
			</section>
			<section>
				<h2>GraphQL Subscriptions</h2>
				<pre><code>
type Subscription {
	count: Int!
}
				</code></pre>
			</section>
			<section>
				<h2>GraphQL Subscriptions</h2>
				<pre><code>
subscription {
	count
}
				</code></pre>
			</section>
			<section>
				<h1>Beyond the Basics</h1>
			</section>
			<section>
				<h1>Learning Curve</h1>
				<p>GraphQL takes <strong>more time</strong> to learn.</p>
			</section>
			<section>
				<h1>Caching</h1>
				<p>Allegedly, GraphQL's caching <strong>is more complex</strong>.</p>
			</section>
			<section>
				<h2>Caching: REST (Express.js)</h2>
				<pre><code>
const express = require('express');
const app = express();
const port = 3000;

app.get('/api/resource', (req, res) => {
		const resource = {
				id: 1,
				name: "Resource",
				value: "Some data",
				lastModified: new Date().toISOString()
		};

		// Set Cache-Control header
		res.setHeader('Cache-Control', 'public, max-age=3600');
		// Set ETag header
		const eTag = 'some-etag-value';
		res.setHeader('ETag', eTag);

		// Check if the client's ETag matches the server's ETag
		if (req.headers['if-none-match'] === eTag) {
				return res.status(304).send(); // Not Modified
		}

		res.json(resource);
});

app.listen(port, () => {
		console.log(`Server is running on http://localhost:${port}`);
});
				</code></pre>
			</section>
			<section>
				<h2>Caching: GraphQL (Apollo Server)</h2>
				<pre><code>
const { ApolloServer, gql } = require('apollo-server');
const { ApolloServerPluginCacheControl } = require('apollo-server-core');

// Schema definition
const typeDefs = gql`
	type Query {
		resource(id: ID!): Resource
	}

	type Resource {
		id: ID!
		name: String
		value: String
	}
`;

// Resolvers
const resolvers = {
	Query: {
		resource: (parent, { id }, context, info) => {
			// Set cache control hints
			info.cacheControl.setCacheHint({ maxAge: 3600 });
			return { id, name: "Resource", value: "Some data" };
		}
	}
};

// Apollo Server setup
const server = new ApolloServer({
	typeDefs,
	resolvers,
	plugins: [ApolloServerPluginCacheControl({ defaultMaxAge: 5 })],
	cacheControl: {
		defaultMaxAge: 3600,
	}
});

server.listen().then(({ url }) => {
	console.log(`Server ready at ${url}`);
});

				</code></pre>
			</section>
			<section>
				<h2>Caching: GraphQL (Apollo Client)</h2>
				<pre><code>
import { ApolloClient, InMemoryCache, gql } from '@apollo/client';

// Initialize Apollo Client
const client = new ApolloClient({
	uri: 'https://example.com/graphql',
	cache: new InMemoryCache()
});

// Query
const GET_RESOURCE = gql`
	query GetResource($id: ID!) {
		resource(id: $id) {
			id
			name
			value
		}
	}
`;

// Fetch data
client.query({
	query: GET_RESOURCE,
	variables: { id: 1 }
}).then(result => {
	console.log(result.data);
	// Data is now cached in the client
});

// Subsequent queries will use the cached data
client.query({
	query: GET_RESOURCE,
	variables: { id: 1 }
}).then(result => {
	console.log('From Cache:', result.data);
});
				</code></pre>
			</section>
			<section>
				<h1>Error Handling</h1>
				<p>Beyond 200 when an error occured.</p>
			</section>
			<section>
				<h1>Error Handling</h1>
				<table>
					<tr>
						<th>REST</th>
						<th>GraphQL</th>
					</tr>
					<tr>
						<td>Status codes to indicate nature of errors</td>
						<td>Error classes (Apollo Server)</td>
					</tr>
					<tr>
						<td>Error messages within response body</td>
						<td>Error messages within resolvers</td>
					</tr>
					<tr>
						<td>Well-known middlewares</td>
						<td>Can be nested "thanks" to GraphQL queries</td>
					</tr>
				</table>
			</section>
			<section>
				<h2>Error Handling: REST</h2>
				<pre><code>
					try {
						const resource = await Resource.findByPk(id);
						if (resource) {
							res.json(resource);
						} else {
							res.status(404).json({ error: 'Resource not found' });
						}
					} catch (error) {
						res.status(500).json({ error: error.message });
					}
				</code></pre>
			</section>
			<section>
				<h2>Error Handling: GraphQL</h2>
				<pre><code>
					try {
						const resource = await Resource.findByPk(id);
						if (resource) {
							return resource;
						} else {
							throw new UserInputError('Resource not found');
						}
					} catch (error) {
						throw new Error('Failed to fetch resource');
					}
				</code></pre>
			</section>
			<section>
				<h1>Global Object Identification</h1>
				<p>Let my frontend fetch single ID.</p>
			</section>
			<section>
				<h2>Global Object Identification: GraphQL</h2>
				<pre><code>
query {
	node(id: "UmVzb3VyY2U6MQ==") {
		id
		... on Resource {
			name
			value
		}
	}
}
				</pre></code>
			</section>
			<section>
				<h2>Global Object Identification: REST</h2>
				<pre><code>
GET /resources/:id
				</code></pre>
			</section>
			<section>
				<h1>StackOverflow</h1>
				<p>What are Developers asking for?</p>
			</section>
			<section>
				<img data-src="assets/graphql-stackoverflow.png">
			</section>
			<section>
				<img data-src="assets/graphql-stackoverflow2.png">
			</section>
			<section>
				<img data-src="assets/graphql-stackoverflow3.png">
			</section>
			<section>
				<img data-src="assets/introspection.png">
			</section>
			<section>
				<h1>Demo</h1>
				<p>Introspection in practice.</p>
			</section>
			<section>
				<img data-src="assets/introspection-security.png">
			</section>
			<section>
				<img data-src="assets/owasp-introspection.png">
			</section>
			<section>
				<img data-src="assets/introspection-off-prod.png">
			</section>
			<!-- <ul>
				<li>Pagination</li>
				<li>Performance</li>
				<li>Sorting</li>
			</ul> -->
		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>
</body>

</html>
